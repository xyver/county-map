========================================================================================================================
WORLD FACTBOOK EXTRACTION DISCREPANCY REPORT - V1 (BASELINE)
========================================================================================================================

Report Date: Before field mapping fixes
Description: Original baseline before scanner and field mapping rebuild

========================================================================================================================
SUMMARY (from original analysis)
========================================================================================================================
OK: 108 (8%)
LOW: 666 (49%) - Partial extraction (<50% expected)
MISSING: 385 (28%) - Zero data extracted
EXTRA: 194 (14%) - Data found but CSV expected none

Total data points with issues: 1051 / 1353 (77%)

========================================================================================================================
KEY ISSUES IDENTIFIED
========================================================================================================================

1. Value Extraction Bug
   - Parser was picking rank (first number) instead of value
   - Fixed in convert_world_factbook.py line 796-811

2. Field ID Mapping Errors
   - world_factbook_field_mappings.json had wrong field IDs for many year/metric combinations
   - Example: crude_oil_production - 2005/2010 use 2173rank.html but mapping said 2241
   - This explains why 2017 works but adjacent years fail

3. CSV Expected Counts Unreliable
   - EXTRA cases suggest CSV just counted file existence, not actual data rows
   - Cannot trust CSV as ground truth - must verify against raw HTML

4. Format Changes Across Eras
   - 2000-2002: Old table format
   - 2003-2017: 2xxx field IDs with rankorder/ structure
   - 2018-2020: New 1xx-3xx field IDs with different structure

========================================================================================================================
PATTERN ANALYSIS
========================================================================================================================

- 2017: Often the ONLY year that works for many metrics
- 2018-2020: Mostly MISSING despite expected data
- 2000-2006: Show EXTRA (data extracted when CSV expected none)
- Most years: LOW (1-49% of expected) - partial extraction

========================================================================================================================
FIXES APPLIED FOR V2
========================================================================================================================

1. Created scan_factbook_fields.py to scan all HTML files and extract correct field IDs
2. Generated field_id_scan_results.json with accurate mappings
3. Created build_field_mappings.py to map metric names to field IDs
4. Rebuilt world_factbook_field_mappings.json with correct IDs from scan
5. Fixed title extraction patterns for 2011-2014 format
6. Fixed value extraction to skip rank and get actual value
7. Re-ran full extraction for all 21 editions

See world_factbook_discrepancy_report_v2.txt for updated results.
