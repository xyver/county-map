"""Generate comprehensive discrepancy report comparing expected vs actual World Factbook data.

Usage:
    python discrepancy_report.py                    # Print to stdout
    python discrepancy_report.py > report_v3.txt   # Save to file with version
"""
import pandas as pd
import sys
from datetime import datetime

# Expected counts from CSV (row 2 onwards after header and overlap row)
expected_data = {
    2020: {'airports':232,'area_sq_km':241,'birth_rate':228,'broadband_subscriptions':203,'budget_surplus_deficit':222,'child_underweight':131,'co2_emissions':213,'crude_oil_exports':217,'crude_oil_imports':217,'crude_oil_production':217,'crude_oil_reserves':214,'current_account_balance':206,'death_rate':228,'education_expenditure':170,'electricity_capacity':214,'electricity_consumption':218,'electricity_exports':218,'electricity_fossil_pct':214,'electricity_hydro_pct':214,'electricity_imports':218,'electricity_nuclear_pct':214,'electricity_production':219,'electricity_renewable_pct':213,'exports':224,'external_debt':207,'fertility_rate':227,'foreign_reserves':195,'gdp_growth_rate':224,'gdp_per_capita_ppp':227,'gdp_ppp':227,'health_expenditures':184,'hiv_deaths':60,'hiv_living':145,'hiv_prevalence':134,'imports':224,'industrial_production_growth':202,'infant_mortality':227,'inflation_rate':228,'internet_users':229,'labor_force':231,'life_expectancy':227,'maternal_mortality':184,'median_age':227,'merchant_marine':182,'military_expenditure_pct':158,'natural_gas_consumption':215,'natural_gas_exports':215,'natural_gas_imports':215,'natural_gas_production':216,'natural_gas_reserves':209,'net_migration_rate':227,'obesity_rate':192,'pop_growth_rate':236,'population':236,'public_debt_pct_gdp':210,'railways_km':136,'refined_petroleum_consumption':214,'refined_petroleum_exports':216,'refined_petroleum_imports':214,'refined_petroleum_production':216,'roadways_km':224,'taxes_revenue_pct_gdp':221,'telephones_fixed':225,'telephones_mobile':219,'unemployment_rate':219,'waterways_km':107,'youth_unemployment':181},
    2019: {'airports':238,'area_sq_km':258,'birth_rate':226,'broadband_subscriptions':197,'budget_surplus_deficit':222,'central_bank_discount_rate':163,'child_underweight':126,'co2_emissions':214,'commercial_bank_prime_rate':193,'crude_oil_exports':218,'crude_oil_imports':218,'crude_oil_production':220,'crude_oil_reserves':215,'current_account_balance':206,'death_rate':226,'education_expenditure':175,'electricity_capacity':215,'electricity_consumption':219,'electricity_exports':219,'electricity_fossil_pct':215,'electricity_hydro_pct':215,'electricity_imports':219,'electricity_nuclear_pct':215,'electricity_production':220,'electricity_renewable_pct':214,'exports':224,'external_debt':207,'fertility_rate':224,'foreign_reserves':195,'gdp_growth_rate':224,'gdp_per_capita_ppp':228,'gdp_ppp':229,'gini_index':158,'gross_national_saving':184,'hiv_deaths':66,'hiv_living':142,'hiv_prevalence':135,'imports':224,'industrial_production_growth':202,'infant_mortality':224,'inflation_rate':226,'internet_users':226,'labor_force':232,'life_expectancy':223,'market_value_traded_shares':124,'maternal_mortality':184,'median_age':228,'merchant_marine':177,'military_expenditure_pct':158,'natural_gas_consumption':216,'natural_gas_exports':216,'natural_gas_imports':216,'natural_gas_production':217,'natural_gas_reserves':210,'net_migration_rate':228,'obesity_rate':192,'pop_growth_rate':234,'population':238,'public_debt_pct_gdp':210,'railways_km':136,'refined_petroleum_consumption':215,'refined_petroleum_exports':217,'refined_petroleum_imports':215,'refined_petroleum_production':217,'roadways_km':215,'stock_broad_money':197,'stock_domestic_credit':192,'stock_fdi_abroad':121,'stock_fdi_at_home':139,'stock_narrow_money':194,'taxes_revenue_pct_gdp':221,'telephones_fixed':221,'telephones_mobile':216,'unemployment_rate':218,'waterways_km':107,'youth_unemployment':181},
    2018: {'airports':238,'area_sq_km':258,'birth_rate':226,'broadband_subscriptions':197,'budget_surplus_deficit':222,'central_bank_discount_rate':163,'child_underweight':126,'co2_emissions':214,'commercial_bank_prime_rate':193,'crude_oil_exports':218,'crude_oil_imports':218,'crude_oil_production':217,'crude_oil_reserves':215,'current_account_balance':206,'death_rate':226,'education_expenditure':179,'electricity_capacity':215,'electricity_consumption':219,'electricity_exports':219,'electricity_fossil_pct':215,'electricity_hydro_pct':215,'electricity_imports':219,'electricity_nuclear_pct':215,'electricity_production':220,'electricity_renewable_pct':214,'exports':224,'external_debt':207,'fertility_rate':224,'foreign_reserves':195,'gdp_growth_rate':224,'gdp_per_capita_ppp':228,'gdp_ppp':229,'gini_index':158,'gross_national_saving':184,'health_expenditures':192,'hiv_deaths':65,'hiv_living':133,'hiv_prevalence':120,'imports':224,'industrial_production_growth':202,'infant_mortality':224,'inflation_rate':226,'internet_users':227,'labor_force':232,'life_expectancy':223,'market_value_traded_shares':124,'maternal_mortality':184,'median_age':228,'merchant_marine':176,'military_expenditure_pct':155,'natural_gas_consumption':216,'natural_gas_exports':216,'natural_gas_imports':216,'natural_gas_production':217,'natural_gas_reserves':210,'net_migration_rate':221,'obesity_rate':192,'pop_growth_rate':234,'population':238,'public_debt_pct_gdp':210,'railways_km':136,'refined_petroleum_consumption':215,'refined_petroleum_exports':217,'refined_petroleum_imports':215,'refined_petroleum_production':217,'roadways_km':223,'stock_broad_money':197,'stock_domestic_credit':192,'stock_fdi_abroad':121,'stock_fdi_at_home':139,'stock_narrow_money':194,'taxes_revenue_pct_gdp':221,'telephones_fixed':221,'telephones_mobile':216,'unemployment_rate':218,'waterways_km':107,'youth_unemployment':174},
    2017: {'airports':236,'area_sq_km':254,'birth_rate':226,'budget_surplus_deficit':221,'central_bank_discount_rate':160,'child_underweight':138,'co2_emissions':214,'commercial_bank_prime_rate':186,'crude_oil_exports':216,'crude_oil_imports':216,'crude_oil_production':217,'crude_oil_reserves':217,'current_account_balance':200,'death_rate':226,'education_expenditure':173,'electricity_capacity':215,'electricity_consumption':220,'electricity_exports':219,'electricity_fossil_pct':215,'electricity_hydro_pct':215,'electricity_imports':220,'electricity_nuclear_pct':215,'electricity_production':221,'electricity_renewable_pct':213,'exports':224,'external_debt':207,'fertility_rate':224,'foreign_reserves':175,'gdp_growth_rate':224,'gdp_per_capita_ppp':230,'gdp_ppp':229,'gini_index':150,'gross_national_saving':181,'health_expenditures':192,'hiv_deaths':63,'hiv_living':119,'hiv_prevalence':109,'imports':223,'industrial_production_growth':202,'infant_mortality':225,'inflation_rate':227,'internet_users':217,'internet_hosts':232,'labor_force':233,'life_expectancy':224,'market_value_traded_shares':123,'maternal_mortality':184,'median_age':229,'merchant_marine':156,'military_expenditure_pct':132,'natural_gas_consumption':216,'natural_gas_exports':215,'natural_gas_imports':215,'natural_gas_production':217,'natural_gas_reserves':212,'net_migration_rate':222,'obesity_rate':192,'pop_growth_rate':235,'population':237,'public_debt_pct_gdp':206,'railways_km':136,'refined_petroleum_consumption':215,'refined_petroleum_exports':217,'refined_petroleum_imports':215,'refined_petroleum_production':217,'roadways_km':223,'stock_broad_money':195,'stock_domestic_credit':192,'stock_fdi_abroad':113,'stock_fdi_at_home':132,'stock_narrow_money':193,'taxes_revenue_pct_gdp':220,'telephones_fixed':219,'telephones_mobile':217,'unemployment_rate':217,'waterways_km':107,'youth_unemployment':134},
    2016: {'airports':236,'area_sq_km':257,'birth_rate':226,'budget_surplus_deficit':220,'central_bank_discount_rate':157,'child_underweight':138,'co2_emissions':213,'commercial_bank_prime_rate':184,'crude_oil_exports':214,'crude_oil_imports':214,'crude_oil_production':214,'crude_oil_reserves':215,'current_account_balance':197,'death_rate':226,'education_expenditure':173,'electricity_capacity':214,'electricity_consumption':219,'electricity_exports':218,'electricity_fossil_pct':214,'electricity_hydro_pct':214,'electricity_imports':219,'electricity_nuclear_pct':214,'electricity_production':220,'electricity_renewable_pct':212,'exports':224,'external_debt':206,'fertility_rate':224,'foreign_reserves':170,'gdp_growth_rate':225,'gdp_per_capita_ppp':229,'gdp_ppp':230,'gini_index':145,'gross_national_saving':180,'health_expenditures':191,'hiv_deaths':129,'hiv_living':127,'hiv_prevalence':133,'imports':223,'industrial_production_growth':202,'infant_mortality':225,'inflation_rate':226,'internet_users':217,'internet_hosts':232,'labor_force':233,'life_expectancy':224,'market_value_traded_shares':122,'maternal_mortality':184,'median_age':229,'merchant_marine':156,'military_expenditure_pct':132,'natural_gas_consumption':215,'natural_gas_exports':215,'natural_gas_imports':214,'natural_gas_production':216,'natural_gas_reserves':212,'net_migration_rate':222,'obesity_rate':191,'pop_growth_rate':235,'population':238,'public_debt_pct_gdp':179,'railways_km':136,'refined_petroleum_consumption':212,'refined_petroleum_exports':214,'refined_petroleum_imports':213,'refined_petroleum_production':214,'roadways_km':223,'stock_broad_money':193,'stock_domestic_credit':191,'stock_fdi_abroad':105,'stock_fdi_at_home':120,'stock_narrow_money':192,'taxes_revenue_pct_gdp':219,'telephones_fixed':219,'telephones_mobile':217,'unemployment_rate':208,'waterways_km':107,'youth_unemployment':134},
    2015: {'airports':236,'area_sq_km':257,'birth_rate':224,'central_bank_discount_rate':138,'child_underweight':213,'commercial_bank_prime_rate':183,'crude_oil_exports':210,'crude_oil_imports':210,'crude_oil_production':211,'crude_oil_reserves':212,'current_account_balance':193,'death_rate':225,'education_expenditure':173,'electricity_capacity':213,'electricity_exports':217,'electricity_fossil_pct':211,'electricity_hydro_pct':211,'electricity_imports':218,'electricity_nuclear_pct':211,'electricity_production':219,'electricity_renewable_pct':210,'exports':223,'external_debt':205,'fertility_rate':224,'foreign_reserves':169,'gdp_growth_rate':222,'gdp_per_capita_ppp':230,'gdp_ppp':230,'gini_index':141,'gross_national_saving':179,'health_expenditures':191,'hiv_deaths':119,'hiv_living':122,'hiv_prevalence':123,'imports':223,'industrial_production_growth':198,'infant_mortality':224,'inflation_rate':225,'internet_users':217,'internet_hosts':232,'labor_force':233,'life_expectancy':224,'market_value_traded_shares':120,'maternal_mortality':184,'merchant_marine':156,'military_expenditure_pct':132,'natural_gas_consumption':213,'natural_gas_exports':212,'natural_gas_imports':212,'natural_gas_production':213,'natural_gas_reserves':212,'net_migration_rate':222,'obesity_rate':191,'pop_growth_rate':233,'population':238,'public_debt_pct_gdp':164,'railways_km':136,'refined_petroleum_consumption':211,'refined_petroleum_exports':211,'refined_petroleum_imports':212,'refined_petroleum_production':212,'roadways_km':223,'stock_broad_money':192,'stock_domestic_credit':190,'stock_fdi_abroad':100,'stock_fdi_at_home':111,'stock_narrow_money':190,'taxes_revenue_pct_gdp':214,'telephones_fixed':219,'telephones_mobile':217,'unemployment_rate':204,'waterways_km':107,'youth_unemployment':134},
    2014: {'airports':236,'area_sq_km':252,'birth_rate':224,'budget_surplus_deficit':216,'central_bank_discount_rate':143,'child_underweight':136,'co2_emissions':211,'commercial_bank_prime_rate':176,'crude_oil_exports':210,'crude_oil_imports':210,'crude_oil_production':211,'crude_oil_reserves':211,'current_account_balance':193,'death_rate':225,'education_expenditure':173,'electricity_capacity':212,'electricity_consumption':219,'electricity_exports':216,'electricity_fossil_pct':210,'electricity_hydro_pct':210,'electricity_imports':217,'electricity_nuclear_pct':210,'electricity_production':219,'electricity_renewable_pct':209,'exports':223,'external_debt':204,'fertility_rate':224,'foreign_reserves':169,'gdp_growth_rate':221,'gdp_per_capita_ppp':228,'gdp_ppp':229,'gini_index':141,'gross_national_saving':155,'health_expenditures':190,'hiv_deaths':158,'hiv_living':165,'hiv_prevalence':170,'imports':222,'industrial_production_growth':194,'infant_mortality':224,'inflation_rate':223,'internet_users':217,'internet_hosts':232,'labor_force':233,'life_expectancy':223,'market_value_traded_shares':110,'maternal_mortality':184,'median_age':228,'merchant_marine':156,'military_expenditure_pct':132,'natural_gas_consumption':213,'natural_gas_exports':212,'natural_gas_imports':212,'natural_gas_production':213,'natural_gas_reserves':211,'net_migration_rate':222,'obesity_rate':191,'pop_growth_rate':233,'population':240,'public_debt_pct_gdp':161,'railways_km':134,'refined_petroleum_consumption':211,'refined_petroleum_exports':211,'refined_petroleum_imports':212,'refined_petroleum_production':212,'roadways_km':222,'stock_broad_money':193,'stock_domestic_credit':189,'stock_fdi_abroad':93,'stock_fdi_at_home':109,'stock_narrow_money':189,'taxes_revenue_pct_gdp':215,'telephones_fixed':220,'telephones_mobile':217,'unemployment_rate':203,'waterways_km':108,'youth_unemployment':147},
    2013: {'airports':236,'area_sq_km':252,'birth_rate':224,'budget_surplus_deficit':215,'central_bank_discount_rate':143,'child_underweight':132,'co2_emissions':211,'commercial_bank_prime_rate':181,'crude_oil_exports':210,'crude_oil_imports':210,'crude_oil_production':211,'crude_oil_reserves':208,'current_account_balance':193,'death_rate':226,'education_expenditure':173,'electricity_capacity':210,'electricity_consumption':218,'electricity_exports':215,'electricity_fossil_pct':209,'electricity_hydro_pct':209,'electricity_imports':215,'electricity_nuclear_pct':209,'electricity_production':218,'electricity_renewable_pct':209,'exports':222,'external_debt':205,'fertility_rate':224,'foreign_reserves':168,'gdp_growth_rate':220,'gdp_per_capita_ppp':229,'gdp_ppp':229,'gini_index':136,'gross_national_saving':144,'health_expenditures':190,'hiv_deaths':153,'hiv_living':163,'hiv_prevalence':166,'imports':223,'industrial_production_growth':179,'infant_mortality':224,'inflation_rate':224,'internet_users':217,'internet_hosts':232,'labor_force':233,'life_expectancy':223,'market_value_traded_shares':118,'maternal_mortality':184,'median_age':228,'merchant_marine':156,'military_expenditure_pct':173,'natural_gas_consumption':213,'natural_gas_exports':211,'natural_gas_imports':212,'natural_gas_production':213,'natural_gas_reserves':210,'net_migration_rate':222,'obesity_rate':191,'pop_growth_rate':233,'population':240,'public_debt_pct_gdp':155,'railways_km':134,'refined_petroleum_consumption':210,'refined_petroleum_exports':210,'refined_petroleum_imports':212,'refined_petroleum_production':211,'roadways_km':222,'stock_broad_money':191,'stock_domestic_credit':190,'stock_fdi_abroad':98,'stock_fdi_at_home':105,'stock_narrow_money':190,'taxes_revenue_pct_gdp':214,'telephones_fixed':220,'telephones_mobile':217,'unemployment_rate':202,'waterways_km':108,'youth_unemployment':142},
    2012: {'airports':237,'area_sq_km':252,'birth_rate':229,'budget_surplus_deficit':213,'central_bank_discount_rate':144,'child_underweight':120,'commercial_bank_prime_rate':181,'crude_oil_reserves':193,'current_account_balance':231,'death_rate':163,'electricity_exports':218,'electricity_fossil_pct':215,'electricity_imports':215,'electricity_production':218,'exports':223,'external_debt':205,'fertility_rate':224,'foreign_reserves':165,'gdp_growth_rate':217,'gdp_per_capita_ppp':228,'gdp_ppp':229,'gini_index':136,'health_expenditures':189,'hiv_deaths':153,'hiv_living':163,'hiv_prevalence':166,'imports':223,'industrial_production_growth':166,'infant_mortality':223,'inflation_rate':224,'internet_users':217,'internet_hosts':233,'labor_force':232,'life_expectancy':222,'market_value_traded_shares':117,'maternal_mortality':183,'median_age':225,'merchant_marine':156,'military_expenditure_pct':172,'net_migration_rate':221,'obesity_rate':70,'pop_growth_rate':231,'population':239,'public_debt_pct_gdp':152,'railways_km':134,'roadways_km':222,'stock_broad_money':191,'stock_domestic_credit':190,'stock_fdi_abroad':91,'stock_fdi_at_home':101,'stock_narrow_money':190,'taxes_revenue_pct_gdp':213,'telephones_fixed':219,'telephones_mobile':216,'unemployment_rate':201,'waterways_km':108,'youth_unemployment':130},
    2011: {'airports':236,'area_sq_km':250,'birth_rate':221,'budget_surplus_deficit':208,'central_bank_discount_rate':144,'child_underweight':120,'commercial_bank_prime_rate':187,'crude_oil_reserves':197,'current_account_balance':223,'death_rate':163,'exports':222,'external_debt':202,'fertility_rate':222,'foreign_reserves':173,'gdp_growth_rate':215,'gdp_per_capita_ppp':227,'gdp_ppp':227,'gini_index':140,'health_expenditures':189,'hiv_deaths':153,'hiv_living':163,'hiv_prevalence':169,'imports':222,'industrial_production_growth':167,'infant_mortality':222,'inflation_rate':222,'internet_users':216,'internet_hosts':231,'labor_force':229,'life_expectancy':221,'market_value_traded_shares':118,'maternal_mortality':172,'median_age':224,'merchant_marine':163,'military_expenditure_pct':172,'net_migration_rate':220,'obesity_rate':70,'pop_growth_rate':230,'population':238,'public_debt_pct_gdp':133,'railways_km':134,'roadways_km':221,'stock_broad_money':190,'stock_domestic_credit':188,'stock_fdi_abroad':85,'stock_fdi_at_home':91,'stock_narrow_money':190,'taxes_revenue_pct_gdp':210,'telephones_fixed':229,'telephones_mobile':219,'unemployment_rate':199,'waterways_km':108,'youth_unemployment':130},
    2010: {'airports':236,'area_sq_km':250,'birth_rate':223,'central_bank_discount_rate':140,'commercial_bank_prime_rate':155,'crude_oil_reserves':190,'current_account_balance':225,'death_rate':186,'exports':223,'external_debt':198,'fertility_rate':224,'foreign_reserves':133,'gdp_growth_rate':214,'gdp_per_capita_ppp':229,'gdp_ppp':228,'gini_index':134,'hiv_deaths':156,'hiv_living':165,'hiv_prevalence':170,'imports':222,'industrial_production_growth':166,'infant_mortality':223,'inflation_rate':224,'internet_users':216,'internet_hosts':232,'labor_force':229,'life_expectancy':223,'market_value_traded_shares':112,'median_age':225,'merchant_marine':163,'military_expenditure_pct':174,'net_migration_rate':221,'pop_growth_rate':232,'population':238,'public_debt_pct_gdp':131,'railways_km':133,'roadways_km':221,'stock_broad_money':187,'stock_domestic_credit':185,'stock_fdi_abroad':80,'stock_fdi_at_home':87,'stock_narrow_money':188,'telephones_fixed':231,'telephones_mobile':221,'unemployment_rate':200,'waterways_km':109},
    2009: {'airports':235,'area_sq_km':249,'birth_rate':223,'central_bank_discount_rate':135,'commercial_bank_prime_rate':142,'crude_oil_exports':208,'crude_oil_imports':208,'crude_oil_production':209,'crude_oil_reserves':209,'current_account_balance':190,'death_rate':222,'education_expenditure':182,'electricity_capacity':214,'electricity_consumption':213,'electricity_fossil_pct':214,'electricity_imports':214,'electricity_production':213,'exports':223,'external_debt':205,'fertility_rate':223,'foreign_reserves':155,'gdp_growth_rate':217,'gdp_per_capita_ppp':229,'gdp_ppp':228,'gini_index':134,'gross_national_saving':150,'hiv_deaths':156,'hiv_living':165,'hiv_prevalence':170,'imports':218,'industrial_production_growth':168,'infant_mortality':224,'inflation_rate':222,'internet_users':216,'internet_hosts':232,'labor_force':221,'life_expectancy':224,'market_value_traded_shares':110,'median_age':226,'merchant_marine':162,'military_expenditure_pct':173,'natural_gas_consumption':209,'natural_gas_exports':207,'natural_gas_imports':206,'natural_gas_production':209,'natural_gas_reserves':207,'net_migration_rate':180,'pop_growth_rate':233,'population':237,'public_debt_pct_gdp':126,'railways_km':132,'refined_petroleum_consumption':206,'refined_petroleum_production':209,'roadways_km':219,'stock_broad_money':129,'stock_domestic_credit':81,'stock_fdi_abroad':96,'stock_fdi_at_home':120,'telephones_fixed':231,'telephones_mobile':222,'unemployment_rate':200,'waterways_km':108},
    2008: {'airports':237,'area_sq_km':258,'birth_rate':224,'central_bank_discount_rate':118,'commercial_bank_prime_rate':162,'crude_oil_exports':207,'crude_oil_imports':207,'crude_oil_production':212,'crude_oil_reserves':201,'current_account_balance':188,'death_rate':223,'education_expenditure':182,'electricity_capacity':214,'exports':227,'external_debt':203,'fertility_rate':223,'foreign_reserves':155,'gdp_growth_rate':218,'gdp_per_capita_ppp':229,'gdp_ppp':229,'hiv_deaths':152,'hiv_living':163,'hiv_prevalence':168,'imports':226,'industrial_production_growth':181,'infant_mortality':222,'inflation_rate':224,'internet_users':222,'internet_hosts':231,'labor_force':224,'life_expectancy':223,'market_value_traded_shares':115,'median_age':162,'merchant_marine':173,'natural_gas_consumption':210,'natural_gas_exports':208,'natural_gas_imports':207,'natural_gas_production':211,'natural_gas_reserves':207,'net_migration_rate':173,'pop_growth_rate':232,'population':240,'public_debt_pct_gdp':126,'railways_km':136,'refined_petroleum_consumption':210,'roadways_km':222,'stock_broad_money':175,'stock_domestic_credit':80,'stock_fdi_abroad':88,'stock_fdi_at_home':173,'telephones_fixed':233,'telephones_mobile':224,'unemployment_rate':199,'waterways_km':109},
    2007: {'airports':239,'area_sq_km':264,'birth_rate':223,'commercial_bank_prime_rate':81,'crude_oil_exports':72,'crude_oil_imports':209,'crude_oil_production':209,'crude_oil_reserves':163,'current_account_balance':222,'electricity_capacity':213,'exports':226,'external_debt':203,'fertility_rate':222,'foreign_reserves':153,'gdp_growth_rate':215,'gdp_per_capita_ppp':228,'gdp_ppp':228,'gross_national_saving':147,'hiv_deaths':147,'hiv_living':163,'hiv_prevalence':168,'imports':226,'industrial_production_growth':166,'infant_mortality':221,'inflation_rate':223,'internet_users':222,'internet_hosts':230,'labor_force':222,'life_expectancy':222,'market_value_traded_shares':113,'median_age':163,'merchant_marine':172,'natural_gas_consumption':207,'natural_gas_exports':110,'natural_gas_imports':110,'natural_gas_production':208,'natural_gas_reserves':100,'pop_growth_rate':237,'railways_km':120,'refined_petroleum_consumption':135,'refined_petroleum_production':218,'roadways_km':73,'stock_broad_money':78,'telephones_fixed':232,'telephones_mobile':224,'unemployment_rate':197,'waterways_km':109},
    2006: {'airports':244,'area_sq_km':273,'birth_rate':227,'commercial_bank_prime_rate':71,'crude_oil_exports':64,'crude_oil_imports':213,'crude_oil_production':100,'crude_oil_reserves':163,'current_account_balance':226,'electricity_capacity':216,'exports':228,'external_debt':209,'fertility_rate':226,'foreign_reserves':153,'gdp_growth_rate':215,'gdp_per_capita_ppp':232,'gdp_ppp':232,'gross_national_saving':147,'hiv_deaths':148,'hiv_living':164,'hiv_prevalence':168,'imports':229,'industrial_production_growth':165,'infant_mortality':225,'inflation_rate':223,'internet_users':226,'internet_hosts':233,'labor_force':226,'life_expectancy':226,'median_age':166,'merchant_marine':167,'natural_gas_consumption':213,'natural_gas_exports':107,'natural_gas_imports':106,'natural_gas_production':213,'natural_gas_reserves':99,'pop_growth_rate':239,'railways_km':120,'refined_petroleum_consumption':137,'refined_petroleum_production':213,'roadways_km':222,'telephones_fixed':235,'telephones_mobile':229,'unemployment_rate':201,'waterways_km':110},
    2005: {'airports':243,'area_sq_km':270,'birth_rate':226,'commercial_bank_prime_rate':58,'crude_oil_exports':46,'crude_oil_imports':213,'crude_oil_production':98,'crude_oil_reserves':149,'current_account_balance':226,'electricity_capacity':217,'exports':226,'external_debt':202,'fertility_rate':226,'foreign_reserves':148,'gdp_growth_rate':214,'gdp_per_capita_ppp':232,'gdp_ppp':232,'gross_national_saving':146,'hiv_deaths':148,'hiv_living':164,'hiv_prevalence':168,'imports':226,'industrial_production_growth':166,'infant_mortality':226,'inflation_rate':223,'internet_users':217,'internet_hosts':191,'labor_force':215,'life_expectancy':226,'median_age':164,'merchant_marine':166,'natural_gas_consumption':109,'natural_gas_exports':109,'natural_gas_imports':109,'natural_gas_production':108,'natural_gas_reserves':98,'pop_growth_rate':239,'railways_km':108,'refined_petroleum_consumption':136,'refined_petroleum_production':213,'roadways_km':231,'telephones_fixed':234,'telephones_mobile':229,'unemployment_rate':196,'waterways_km':110},
    2004: {'airports':270,'area_sq_km':270,'birth_rate':226,'commercial_bank_prime_rate':35,'crude_oil_exports':31,'crude_oil_imports':213,'crude_oil_production':98,'crude_oil_reserves':149,'current_account_balance':226,'electricity_capacity':214,'exports':226,'external_debt':200,'fertility_rate':226,'foreign_reserves':147,'gdp_growth_rate':215,'gdp_per_capita_ppp':232,'gdp_ppp':232,'gross_national_saving':145,'hiv_deaths':148,'hiv_living':164,'hiv_prevalence':168,'imports':226,'industrial_production_growth':165,'infant_mortality':226,'inflation_rate':222,'internet_users':214,'internet_hosts':191,'labor_force':211,'life_expectancy':226,'median_age':166,'natural_gas_consumption':109,'natural_gas_exports':109,'natural_gas_imports':109,'natural_gas_production':109,'natural_gas_reserves':98,'pop_growth_rate':239,'railways_km':109,'refined_petroleum_consumption':135,'refined_petroleum_production':213,'roadways_km':229,'telephones_fixed':234,'telephones_mobile':229,'unemployment_rate':192},
    2003: {'area_sq_km':267,'birth_rate':225,'commercial_bank_prime_rate':28,'crude_oil_exports':28,'crude_oil_imports':212,'crude_oil_production':97,'current_account_balance':225,'electricity_capacity':214,'exports':225,'external_debt':198,'fertility_rate':225,'gdp_growth_rate':213,'gdp_per_capita_ppp':231,'gdp_ppp':237,'hiv_deaths':143,'hiv_living':155,'hiv_prevalence':168,'imports':225,'industrial_production_growth':164,'infant_mortality':225,'inflation_rate':219,'internet_users':203,'labor_force':205,'life_expectancy':225,'median_age':166,'natural_gas_reserves':97,'pop_growth_rate':237,'railways_km':148,'refined_petroleum_consumption':212,'roadways_km':228,'telephones_fixed':230,'telephones_mobile':208,'unemployment_rate':189},
    2002: {'airports':254,'area_sq_km':268,'birth_rate':236,'current_account_balance':236,'death_rate':236,'electricity_capacity':234,'exports':236,'external_debt':234,'fertility_rate':236,'gdp_growth_rate':236,'gdp_per_capita_ppp':236,'gdp_ppp':236,'hiv_deaths':237,'hiv_living':237,'hiv_prevalence':236,'imports':236,'industrial_production_growth':235,'infant_mortality':236,'inflation_rate':236,'internet_users':236,'labor_force':235,'life_expectancy':236,'median_age':197,'pop_growth_rate':263,'railways_km':237,'roadways_km':240,'telephones_fixed':239,'telephones_mobile':237,'unemployment_rate':235},
    2001: {'airports':253,'area_sq_km':267,'birth_rate':232,'current_account_balance':232,'exports':235,'external_debt':232,'fertility_rate':232,'gdp_growth_rate':235,'gdp_per_capita_ppp':235,'gdp_ppp':235,'hiv_deaths':235,'hiv_living':235,'hiv_prevalence':235,'imports':235,'industrial_production_growth':235,'infant_mortality':235,'inflation_rate':232,'labor_force':235,'life_expectancy':232,'median_age':196,'pop_growth_rate':262,'railways_km':232,'telephones_mobile':233},
    2000: {'airports':253,'area_sq_km':262,'birth_rate':235,'electricity_capacity':235,'electricity_consumption':235,'electricity_exports':235,'electricity_imports':235,'electricity_production':235,'exports':235,'fertility_rate':235,'gdp_growth_rate':235,'gdp_per_capita_ppp':235,'gdp_ppp':235,'hiv_prevalence':235,'imports':235,'industrial_production_growth':196,'infant_mortality':235,'life_expectancy':235,'pop_growth_rate':262,'railways_km':235,'telephones_mobile':235},
}

# Read parquet files
unique_df = pd.read_parquet('c:/Users/Bryan/Desktop/county-map-data/data/world_factbook/all_countries.parquet')
overlap_df = pd.read_parquet('c:/Users/Bryan/Desktop/county-map-data/data/world_factbook_overlap/all_countries.parquet')

# Get all metrics
unique_metrics = sorted([c for c in unique_df.columns if c not in ['loc_id', 'year', 'factbook_edition']])
overlap_metrics = sorted([c for c in overlap_df.columns if c not in ['loc_id', 'year', 'factbook_edition']])

years = sorted(expected_data.keys())

def count_actual(df, metric, edition_year):
    """Count non-null values for a metric in a specific factbook edition."""
    if metric not in df.columns:
        return 0
    # Use factbook_edition column, not year (which is the data year)
    edition_data = df[df['factbook_edition'] == edition_year]
    return int(edition_data[metric].notna().sum())

print('='*120)
print('COMPREHENSIVE WORLD FACTBOOK EXTRACTION DISCREPANCY REPORT')
print('='*120)
print()
print(f'Factbook editions: {min(years)} - {max(years)} ({len(years)} years)')
print(f'Unique metrics: {len(unique_metrics)}')
print(f'Overlap metrics: {len(overlap_metrics)}')
print()

# Track status totals
totals = {'OK': 0, 'LOW': 0, 'MISSING': 0, 'EXTRA': 0}

print('='*120)
print('PART 1: UNIQUE METRICS (world_factbook parquet) - 51 metrics')
print('='*120)

for metric in unique_metrics:
    print(f'\n--- {metric} ---')
    for year in years:
        exp = expected_data.get(year, {}).get(metric, 0)
        act = count_actual(unique_df, metric, year)

        if exp == 0 and act == 0:
            continue  # Skip rows with no data
        elif exp == 0 and act > 0:
            status = 'EXTRA'
            symbol = '[EXTRA]'
        elif act == 0 and exp > 0:
            status = 'MISSING'
            symbol = '[MISSING]'
        elif act < exp * 0.5:
            pct = int(act*100/exp) if exp > 0 else 0
            status = 'LOW'
            symbol = f'[LOW {pct}%]'
        else:
            status = 'OK'
            symbol = '[OK]'

        totals[status] = totals.get(status, 0) + 1
        print(f'  {year}: expected {exp:>3}, got {act:>3} {symbol}')

print()
print('='*120)
print('PART 2: OVERLAP METRICS (world_factbook_overlap parquet) - 27 metrics')
print('='*120)

for metric in overlap_metrics:
    print(f'\n--- {metric} ---')
    for year in years:
        exp = expected_data.get(year, {}).get(metric, 0)
        act = count_actual(overlap_df, metric, year)

        if exp == 0 and act == 0:
            continue
        elif exp == 0 and act > 0:
            status = 'EXTRA'
            symbol = '[EXTRA]'
        elif act == 0 and exp > 0:
            status = 'MISSING'
            symbol = '[MISSING]'
        elif act < exp * 0.5:
            pct = int(act*100/exp) if exp > 0 else 0
            status = 'LOW'
            symbol = f'[LOW {pct}%]'
        else:
            status = 'OK'
            symbol = '[OK]'

        totals[status] = totals.get(status, 0) + 1
        print(f'  {year}: expected {exp:>3}, got {act:>3} {symbol}')

print()
print('='*120)
print('SUMMARY')
print('='*120)
for status in ['OK', 'LOW', 'MISSING', 'EXTRA']:
    print(f'{status}: {totals.get(status, 0)}')

total_issues = totals.get('LOW', 0) + totals.get('MISSING', 0)
total_all = sum(totals.values())
print(f'\nTotal data points with issues: {total_issues} / {total_all} ({int(total_issues*100/total_all) if total_all > 0 else 0}%)')
